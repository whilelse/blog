<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Reactive Box | Whilelse Blog</title>
  <meta name="author" content="Stimulus Software Limited">
  
  <meta name="description" content="Today I had great success with implementing some basic reactive functionality.
At the basis of the editor UI there is a really crude reactive library ">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Reactive Box"/>
  <meta property="og:site_name" content="Whilelse Blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Whilelse Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Whilelse Blog</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      
        <li><a href="http://whilelse.com">Whilelse</a></li>
      
    
      
        <li><a href="/">Blog</a></li>
      
    
      
        <li><a href="/archives">Archives</a></li>
      
    
      
        <li><a href="/atom.xml">RSS</a></li>
      
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-02-06T15:51:43.000Z"><a href="/2016/reactive-box/">2016-02-06</a></time>
      
      
  
    <h1 class="title">Reactive Box</h1>
  

    </header>
    <div class="entry">
      
        <p>Today I had great success with implementing some basic reactive functionality.</p>
<p>At the basis of the editor UI there is a really crude reactive library I wrote. The idea is that you create boxes for values, and you call a getter to retrieve the value, but every time you call it, a dependency is recorded. There’s also a compute function which takes a computation function as argument, and takes the dependencies recorded during the execution of the computation and sets things up so when any dependency box’s content changes the whole computation function is re-run. This computation function should have some sort of side-effect, e.g. setting another box’s value or updating a DOM element.</p>
<p>This method results in a lot of noise in the code for setting up each box. Now, as I’m in the process of reimplementing the UI with itself, it occurred to me that I can just add a new language element for defining a box. I can set the type of a class property to a box and then just use it as a normal variable, and let the transpiler insert all the repetitive code that makes it work.</p>
<p>This now works for my little contrived example: I have a class with three reactive box properties; <code>x</code> is initialised through the constructor and can also be set from the outside. Whenever <code>x</code> changes, <code>y</code> will be automatically set to <code>x*5</code>. When <code>y</code> changes, <code>z</code> is set to the string <code>&quot;Z:&quot;+y</code>. Whenever <code>z</code> changes, the <code>compute</code> block on the top updates the DOM. As I set the value of <code>x</code> to <code>0</code>, <code>1</code>, <code>2</code>, the DOM shows <code>Z:0</code>, <code>Z:5</code>, <code>Z:10</code>, etc.</p>
<p>Whilelse code rendering:</p>
<img src="/images/reactive-box-whilelse.png" title="Example code using reactive box elements as shown in the Whilelse editor">
<figure class="highlight javascript"><figcaption><span>Generated JavaScript code</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">box</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'lib/box'</span>).box.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compute</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'lib/box'</span>).compute.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Calculator = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Calculator.displayName = <span class="string">'Calculator'</span>;</span><br><span class="line">    <span class="keyword">var</span> prototype = Calculator.prototype;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Calculator</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="keyword">this</span>$ = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">this</span>$.x$box = box(<span class="string">'acinqOszyXna'</span>, <span class="literal">undefined</span>);</span><br><span class="line">        <span class="keyword">this</span>$.y$box = box(<span class="string">'acOiZUpDkUA2'</span>, <span class="literal">undefined</span>);</span><br><span class="line">        <span class="keyword">this</span>$.z$box = box(<span class="string">'acOYmFYEVhx3'</span>, <span class="literal">undefined</span>);</span><br><span class="line">        <span class="keyword">this</span>$.x$set(x);</span><br><span class="line">    &#125;</span><br><span class="line">    prototype.x$get = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="keyword">this</span>$ = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>$.x$box.get();</span><br><span class="line">    &#125;;</span><br><span class="line">    prototype.x$set = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>$ = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">this</span>$.x$box.set(value);</span><br><span class="line">    &#125;;</span><br><span class="line">    prototype.y$get = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="keyword">this</span>$ = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>$.y$boxInited) &#123;</span><br><span class="line">            <span class="keyword">this</span>$.y$boxInited = <span class="literal">true</span>;</span><br><span class="line">            compute(<span class="string">'acOiZUpDkUA2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>$.y$box.set(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>$.x$get() * <span class="number">5</span>;</span><br><span class="line">                &#125;());</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>$.y$box.get();</span><br><span class="line">    &#125;;</span><br><span class="line">    prototype.z$get = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="keyword">this</span>$ = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>$.z$boxInited) &#123;</span><br><span class="line">            <span class="keyword">this</span>$.z$boxInited = <span class="literal">true</span>;</span><br><span class="line">            compute(<span class="string">'acOYmFYEVhx3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>$.z$box.set(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">'Z:'</span> + <span class="keyword">this</span>$.y$get();</span><br><span class="line">                &#125;());</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>$.z$box.get();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> Calculator;</span><br><span class="line">&#125;();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> el;</span><br><span class="line">    el = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>];</span><br><span class="line">    el.innerHTML = <span class="string">''</span>;</span><br><span class="line">    el.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">''</span> + x));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> calc;</span><br><span class="line">    <span class="keyword">var</span> num;</span><br><span class="line">    num = <span class="number">0</span>;</span><br><span class="line">    calc = <span class="keyword">new</span> Calculator(num);</span><br><span class="line">    compute(<span class="string">'ac48AuoEg1PD'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        display(calc.z$get());</span><br><span class="line">    &#125;);</span><br><span class="line">    ;</span><br><span class="line">    setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        calc.x$set(num++);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:blog.whilelse.com">
  </form>
</div>

  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 Stimulus Software Limited
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>